<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Pok√©mon con MongoDB</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">CRUD Pok√©mon</a>
        </div>
    </nav>

    <div class="container mt-4">
        <h1 class="text-center">CRUD de Pok√©mon</h1>

        <!-- Formulario -->
        <div class="card mt-4 shadow">
            <div class="card-header bg-primary text-white">
                <h5 id="form-title">Registrar Pok√©mon</h5>
            </div>
            <div class="card-body">
                <form id="pokemon-form">
                    <input type="hidden" id="pokemon-id">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="nombre" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="nombre" required>
                        </div>
                        <div class="col-md-6">
                            <label for="especie" class="form-label">Especie</label>
                            <input type="text" class="form-control" id="especie" required>
                        </div>
                        <div class="col-md-6 mt-2">
                            <label for="tipo" class="form-label">Tipo</label>
                            <input type="text" class="form-control" id="tipo" required>
                        </div>
                        <div class="col-md-6 mt-2">
                            <label for="nivel" class="form-label">Nivel</label>
                            <input type="number" class="form-control" id="nivel" required>
                        </div>
                        <div class="col-md-6 mt-2">
                            <label for="habilidad" class="form-label">Habilidad</label>
                            <input type="text" class="form-control" id="habilidad" required>
                        </div>
                        <div class="col-md-6 mt-2">
                            <label for="entrenador" class="form-label">Entrenador</label>
                            <input type="text" class="form-control" id="entrenador" required>
                        </div>
                        <div class="col-md-6 mt-2">
                            <label for="edad" class="form-label">Edad</label>
                            <input type="number" class="form-control" id="edad" required>
                        </div>
                        <div class="col-md-6 mt-2">
                            <label for="region" class="form-label">Regi√≥n</label>
                            <input type="text" class="form-control" id="region" required>
                        </div>
                    </div>
                    <div class="mt-3 text-end">
                        <button type="submit" class="btn btn-success">Guardar Pok√©mon</button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla -->
        <div class="card mt-4 shadow">
            <div class="card-header bg-success text-white">
                <h5>Lista de Pok√©mon</h5>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Especie</th>
                            <th>Tipo</th>
                            <th>Nivel</th>
                            <th>Habilidad</th>
                            <th>Entrenador</th>
                            <th>Edad</th>
                            <th>Regi√≥n</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="pokemon-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://tu-backend.onrender.com"; // Cambia esta URL con la de Render

        document.getElementById('pokemon-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('pokemon-id').value;
            if (id) {
                actualizarPokemon(id);
            } else {
                agregarPokemon();
            }
        });

        function agregarPokemon() {
            const pokemon = obtenerDatosFormulario();
            fetch(`${API_URL}/agregarPokemon`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(pokemon)
            })
            .then(response => response.json())
            .then(() => {
                resetForm();
                cargarPokemones();
            });
        }

        function actualizarPokemon(id) {
            const pokemon = obtenerDatosFormulario();
            fetch(`${API_URL}/actualizarPokemon/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(pokemon)
            })
            .then(response => response.json())
            .then(() => {
                resetForm();
                cargarPokemones();
            });
        }

        function eliminarPokemon(id) {
            if (confirm("¬øSeguro que deseas eliminar este Pok√©mon?")) {
                fetch(`${API_URL}/eliminarPokemon/${id}`, { method: 'DELETE' })
                .then(() => cargarPokemones());
            }
        }

        function editarPokemon(id) {
            fetch(`${API_URL}/obtenerPokemon/${id}`)
            .then(response => response.json())
            .then(pokemon => {
                document.getElementById('pokemon-id').value = pokemon._id;
                document.getElementById('nombre').value = pokemon.nombre;
                document.getElementById('especie').value = pokemon.especie;
                document.getElementById('tipo').value = pokemon.tipo;
                document.getElementById('nivel').value = pokemon.nivel;
                document.getElementById('habilidad').value = pokemon.habilidad;
                document.getElementById('entrenador').value = pokemon.entrenador;
                document.getElementById('edad').value = pokemon.edad;
                document.getElementById('region').value = pokemon.region;
                document.getElementById('form-title').innerText = "Editar Pok√©mon";
            });
        }

        function resetForm() {
            document.getElementById('pokemon-id').value = "";
            document.getElementById('pokemon-form').reset();
            document.getElementById('form-title').innerText = "Registrar Pok√©mon";
        }

        function obtenerDatosFormulario() {
            return {
                nombre: document.getElementById('nombre').value,
                especie: document.getElementById('especie').value,
                tipo: document.getElementById('tipo').value,
                nivel: document.getElementById('nivel').value,
                habilidad: document.getElementById('habilidad').value,
                entrenador: document.getElementById('entrenador').value,
                edad: document.getElementById('edad').value,
                region: document.getElementById('region').value
            };
        }

        function cargarPokemones() {
            fetch(`${API_URL}/obtenerPokemones`)
            .then(response => response.json())
            .then(pokemones => {
                const tbody = document.getElementById('pokemon-table-body');
                tbody.innerHTML = "";
                pokemones.forEach(pokemon => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${pokemon._id}</td>
                            <td>${pokemon.nombre}</td>
                            <td>${pokemon.especie}</td>
                            <td>${pokemon.tipo}</td>
                            <td>${pokemon.nivel}</td>
                            <td>${pokemon.habilidad}</td>
                            <td>${pokemon.entrenador}</td>
                            <td>${pokemon.edad}</td>
                            <td>${pokemon.region}</td>
                            <td>
                                <button class="btn btn-warning btn-sm" onclick="editarPokemon('${pokemon._id}')">‚úèÔ∏è</button>
                                <button class="btn btn-danger btn-sm" onclick="eliminarPokemon('${pokemon._id}')">üóë</button>
                            </td>
                        </tr>
                    `;
                });
            });
        }

        document.addEventListener("DOMContentLoaded", cargarPokemones);
    </script>

</body>
</html>
